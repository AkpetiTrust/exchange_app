import React, { useState, useEffect } from "react";
import { Link } from "react-router-dom";
import Currency from "../Currency/Currency";

const Main = () => {
  const [targetCurrency, setTargetCurrency] = useState("NGN");
  const [map, setMap] = useState([]);
  const [activeCurrencies, setActiveCurrencies] = useState([
    "BTC",
    "ETH",
    "BNB",
    "LTC",
  ]);

  useEffect(() => {
    fetch(
      "https://min-api.cryptocompare.com/data/all/coinlist?summary=true&api_key=5d430aae2f069034b3334addf3f224145c187aa3644c07303886f09fe1e3f19a"
    )
      .then((res) => res.json())
      .then((data) => {
        let mapArray = [];
        let responseData = data.Data;
        Object.keys(responseData).forEach((key) => {
          let fullName = responseData[key].FullName;
          let mapObject = { fullName, shortName: key };
          mapArray.push(mapObject);
        });
        setMap(mapArray);
      });
  }, []);

  const handleSearch = (e) => {
    const value = e.currentTarget.value;

    if (!value) {
      setActiveCurrencies(["BTC", "ETH", "BNB", "LTC"]);
      return;
    }

    let filteredCurrencies = map
      .filter((currency) =>
        currency.fullName.toLowerCase().includes(value.toLowerCase())
      )
      .sort((a, b) => {
        return a.fullName.length - b.fullName.length;
      })
      .map((currencyObject) => currencyObject.shortName);
    setActiveCurrencies(filteredCurrencies.slice(0, 10));
  };

  return (
    <main className='home-main'>
      <header className='center'>
        <h1 className='title'>
          Live <span>Crypto</span>currency Prices
        </h1>
      </header>
      <section className='main-inner'>
        <div className='currencies-section'>
          <div className='input-wrapper'>
            <svg
              width='13'
              height='13'
              viewBox='0 0 13 13'
              fill='none'
              className='search-icon'
              xmlns='http://www.w3.org/2000/svg'>
              <path
                d='M11.5477 10.8481L8.25068 7.55117C8.7623 6.88975 9.03906 6.08105 9.03906 5.23047C9.03906 4.2123 8.6417 3.25762 7.92314 2.53779C7.20459 1.81797 6.24736 1.42188 5.23047 1.42188C4.21357 1.42188 3.25635 1.81924 2.53779 2.53779C1.81797 3.25635 1.42188 4.2123 1.42188 5.23047C1.42188 6.24736 1.81924 7.20459 2.53779 7.92314C3.25635 8.64297 4.2123 9.03906 5.23047 9.03906C6.08105 9.03906 6.88848 8.7623 7.5499 8.25195L10.8469 11.5477C10.8565 11.5573 10.868 11.565 10.8807 11.5702C10.8933 11.5755 10.9068 11.5782 10.9205 11.5782C10.9342 11.5782 10.9477 11.5755 10.9604 11.5702C10.973 11.565 10.9845 11.5573 10.9941 11.5477L11.5477 10.9954C11.5573 10.9857 11.565 10.9743 11.5702 10.9616C11.5755 10.949 11.5782 10.9355 11.5782 10.9218C11.5782 10.9081 11.5755 10.8946 11.5702 10.8819C11.565 10.8693 11.5573 10.8578 11.5477 10.8481ZM7.24141 7.24141C6.70313 7.77842 5.98965 8.07422 5.23047 8.07422C4.47129 8.07422 3.75781 7.77842 3.21953 7.24141C2.68252 6.70313 2.38672 5.98965 2.38672 5.23047C2.38672 4.47129 2.68252 3.75654 3.21953 3.21953C3.75781 2.68252 4.47129 2.38672 5.23047 2.38672C5.98965 2.38672 6.70439 2.68125 7.24141 3.21953C7.77842 3.75781 8.07422 4.47129 8.07422 5.23047C8.07422 5.98965 7.77842 6.70439 7.24141 7.24141Z'
                fill='black'
              />
            </svg>
            <input
              type='text'
              className='search'
              placeholder='Search'
              onChange={handleSearch}
            />
          </div>
          <div className='currencies'>
            {activeCurrencies.map((currency) => (
              <Currency
                key={currency + map[0]?.fullName + targetCurrency}
                activeCurrency={currency}
                targetCurrency={targetCurrency}
                map={map}
              />
            ))}
            {!activeCurrencies.length && (
              <div className='center fallback'>
                <p>E nor dey boss ðŸ˜”</p>
              </div>
            )}
          </div>
        </div>
        <div className='target-section'>
          <p className='target-title'>Target currency:</p>
          <select
            onChange={(e) => {
              setTargetCurrency(e.currentTarget.value);
            }}>
            <option value='NGN'>NGN</option>
            <option value='USD'>USD</option>
            <option value='EUR'>EUR</option>
          </select>
          <p className='light'>Want to convert one coin to another?</p>
          <div className='link-container'>
            <Link to='/calculator'>USE CALCULATOR</Link>
          </div>
        </div>
      </section>
      <section className='image mobile-none center'>
        <svg
          width='341'
          height='299'
          viewBox='0 0 341 299'
          fill='none'
          xmlns='http://www.w3.org/2000/svg'>
          <g clipPath='url(#clip0)'>
            <path
              d='M311.967 230.156C339.356 205.329 349.087 171.399 333.701 154.372C318.316 137.345 283.641 143.668 256.252 168.495C228.864 193.323 219.133 227.252 234.518 244.28C249.903 261.307 284.578 254.984 311.967 230.156Z'
              fill='#F2F2F2'
            />
            <path
              d='M232.279 298.122C228.586 290.479 227.278 281.869 227.921 273.438C228.619 265.061 231.086 256.927 235.16 249.577C239.115 242.484 244.132 236.039 250.036 230.468C256.239 224.517 263.234 219.464 270.593 215.049C278.364 210.386 286.53 206.423 294.791 202.716C295.821 202.253 296.852 201.795 297.884 201.34C298.562 201.041 297.976 200.046 297.302 200.343C288.88 204.057 280.528 207.972 272.542 212.565C264.912 216.953 257.613 221.972 251.092 227.904C244.947 233.406 239.652 239.793 235.382 246.855C231.011 254.121 228.177 262.21 227.055 270.619C225.978 279.087 226.81 287.894 230.016 295.839C230.406 296.808 230.829 297.763 231.283 298.705C231.607 299.373 232.602 298.788 232.279 298.122Z'
              fill='#E6E6E6'
            />
            <path
              d='M264.089 217.994C263.708 211.696 264.181 205.376 265.495 199.205C266.806 193.032 268.933 187.061 271.821 181.45C273.446 178.301 275.309 175.28 277.393 172.415C277.831 171.813 276.831 171.236 276.397 171.832C272.653 176.997 269.622 182.646 267.387 188.624C265.147 194.603 263.71 200.854 263.113 207.212C262.776 210.796 262.717 214.401 262.936 217.994C262.981 218.733 264.134 218.738 264.089 217.994H264.089Z'
              fill='#E6E6E6'
            />
            <path
              d='M140.7 208.553C176.349 176.238 189.015 132.075 168.989 109.912C148.964 87.7492 103.831 95.9794 68.1815 128.295C32.5322 160.61 19.8667 204.773 39.8921 226.936C59.9176 249.099 105.051 240.869 140.7 208.553Z'
              fill='#F2F2F2'
            />
            <path
              d='M36.9777 297.017C32.1703 287.07 30.4679 275.862 31.3049 264.889C32.1366 253.985 35.4984 243.407 40.7271 233.832C45.7905 224.559 52.4829 216.258 60.0902 208.959C68.164 201.213 77.2684 194.636 86.8474 188.889C96.9625 182.819 107.591 177.662 118.344 172.836C119.684 172.235 121.026 171.638 122.37 171.046C123.252 170.657 122.489 169.361 121.612 169.748C110.649 174.582 99.7791 179.677 89.3841 185.656C79.4533 191.367 69.9524 197.901 61.4641 205.621C53.5457 212.824 46.4888 221.063 41.0169 230.288C35.3273 239.746 31.6379 250.274 30.1773 261.219C28.7754 272.242 29.8592 283.704 34.0313 294.047C34.54 295.308 35.0902 296.551 35.6817 297.776C36.1025 298.646 37.3972 297.885 36.9777 297.017V297.017Z'
              fill='#E6E6E6'
            />
            <path
              d='M78.3814 192.722C77.8852 184.525 78.5011 176.299 80.2122 168.267C81.9179 160.231 84.6867 152.459 88.4453 145.157C90.5611 141.058 92.9858 137.126 95.6984 133.396C96.2678 132.613 94.966 131.862 94.4023 132.637C89.5286 139.361 85.5837 146.713 82.6745 154.495C79.7586 162.277 77.8878 170.413 77.111 178.688C76.6726 183.353 76.5955 188.045 76.8803 192.723C76.9388 193.684 78.4402 193.69 78.3813 192.723L78.3814 192.722Z'
              fill='#E6E6E6'
            />
            <path
              d='M210.138 10.9146L193.386 38.578L210.102 48.4864L210.138 10.9146Z'
              fill='#8C8C8C'
            />
            <path
              d='M193.442 38.6347L210.102 31.0293L210.081 48.4981L193.442 38.6347Z'
              fill='#383838'
            />
            <path
              d='M210.065 10.9146L226.818 38.578L210.102 48.4864L210.065 10.9146Z'
              fill='#333333'
            />
            <path
              d='M226.761 38.6347L210.102 31.0293L210.122 48.4981L226.761 38.6347Z'
              fill='#141414'
            />
            <path
              d='M193.442 41.8091L210.081 65.2776V51.6725L193.442 41.8091Z'
              fill='#8C8C8C'
            />
            <path
              d='M226.721 41.8091L210.081 65.2776V51.6725L226.721 41.8091Z'
              fill='#333333'
            />
            <path
              d='M210.236 85.2177C201.237 85.2177 192.271 79.0218 184.99 67.7715C178.588 57.8792 174.611 45.5832 174.611 35.6823C174.611 30.9964 175.533 26.3564 177.323 22.0273C179.113 17.6981 181.737 13.7645 185.045 10.4511C188.353 7.13769 192.281 4.50935 196.603 2.71615C200.925 0.922948 205.558 0 210.236 0C214.914 0 219.547 0.922948 223.869 2.71615C228.191 4.50935 232.118 7.13769 235.426 10.4511C238.735 13.7645 241.359 17.6981 243.149 22.0273C244.939 26.3564 245.861 30.9964 245.861 35.6823C245.861 45.5832 241.884 57.8792 235.482 67.7715C228.201 79.0218 219.235 85.2177 210.236 85.2177ZM210.236 0.839583C201.013 0.850009 192.171 4.52427 185.65 11.0563C179.128 17.5883 175.46 26.4446 175.449 35.6823C175.449 54.9119 191.034 84.3781 210.236 84.3781C229.438 84.3781 245.023 54.9119 245.023 35.6823C245.012 26.4446 241.344 17.5883 234.822 11.0563C228.301 4.52427 219.459 0.85001 210.236 0.839583Z'
              fill='#3F3D56'
            />
            <path
              d='M213.594 92.7739H206.877C206.563 92.7739 206.254 92.7033 205.971 92.5674C205.688 92.4314 205.439 92.2335 205.243 91.9884C205.046 91.7432 204.907 91.457 204.836 91.1509C204.765 90.8447 204.764 90.5265 204.832 90.2197L206.128 84.3781H214.344L215.64 90.2197C215.708 90.5265 215.706 90.8447 215.635 91.1509C215.564 91.457 215.425 91.7432 215.229 91.9884C215.033 92.2335 214.784 92.4314 214.501 92.5674C214.218 92.7033 213.908 92.7739 213.594 92.7739H213.594ZM206.8 85.2177L205.65 90.4017C205.609 90.5858 205.61 90.7768 205.653 90.9604C205.695 91.1441 205.779 91.3159 205.896 91.463C206.014 91.6101 206.164 91.7288 206.333 91.8104C206.503 91.892 206.689 91.9343 206.877 91.9343H213.594C213.783 91.9343 213.969 91.892 214.138 91.8104C214.308 91.7288 214.457 91.6101 214.575 91.463C214.693 91.3159 214.776 91.1441 214.819 90.9604C214.862 90.7768 214.863 90.5858 214.822 90.4017L213.672 85.2177H206.8Z'
              fill='#3F3D56'
            />
            <path
              d='M193.656 10.4366C188.125 13.8003 184.148 19.2195 182.593 25.5105C182.163 27.2601 181.935 29.0534 181.912 30.8551C181.918 31.0183 181.986 31.173 182.104 31.2865C182.221 31.3999 182.378 31.4634 182.541 31.4634C182.704 31.4634 182.861 31.3999 182.978 31.2865C183.095 31.173 183.164 31.0183 183.169 30.8551C183.297 24.7337 185.831 18.9099 190.219 14.648C191.451 13.4517 192.817 12.4033 194.29 11.524C194.428 11.4368 194.527 11.2993 194.566 11.1405C194.604 10.9818 194.58 10.8142 194.498 10.6731C194.415 10.5321 194.282 10.4285 194.124 10.3844C193.967 10.3403 193.799 10.359 193.656 10.4366H193.656Z'
              fill='#3F3D56'
            />
            <path
              d='M204.413 86.0087C212.009 85.6193 220.652 85.4118 226.572 91.0234C229.041 93.364 230.598 96.5006 230.504 99.9487C230.402 103.701 228.497 107.216 226.136 110.035C221.054 116.103 213.601 119.897 206.453 122.956C198.856 126.206 190.942 128.744 183.643 132.666C177.234 136.11 171.261 140.758 167.389 147.02C165.485 150.056 164.221 153.45 163.677 156.993C163.178 160.545 163.358 164.159 164.207 167.644C165.912 174.786 170.109 181.099 175.703 185.789C181.363 190.535 188.22 193.696 195.324 195.585C203.758 197.826 212.545 198.334 221.234 198.385C230.209 198.437 239.191 197.997 248.159 198.501C250.34 198.624 252.518 198.804 254.688 199.056C255.491 199.149 255.484 197.889 254.688 197.797C245.729 196.757 236.699 196.995 227.7 197.097C218.877 197.197 209.979 197.166 201.266 195.606C193.753 194.261 186.387 191.74 180.016 187.464C173.912 183.367 168.938 177.624 166.421 170.655C163.962 163.847 163.988 156.313 167.28 149.787C170.577 143.252 176.327 138.309 182.575 134.702C189.786 130.539 197.726 127.934 205.386 124.76C212.621 121.761 220.022 118.187 225.579 112.519C228.153 109.894 230.358 106.699 231.301 103.105C231.762 101.424 231.873 99.6662 231.628 97.9403C231.382 96.2144 230.786 94.5574 229.875 93.0718C228.053 90.2783 225.452 88.0822 222.395 86.7562C218.706 85.0912 214.613 84.6112 210.601 84.5706C208.537 84.5498 206.474 84.6437 204.413 84.7493C203.608 84.7906 203.603 86.0502 204.413 86.0087H204.413Z'
              fill='#3F3D56'
            />
            <path
              d='M165.748 290.388L160.709 291.393L154.44 272.403L161.878 270.919L165.748 290.388Z'
              fill='#FFB8B8'
            />
            <path
              d='M168.006 295.024L151.757 298.265L151.716 298.059C151.551 297.227 151.551 296.371 151.716 295.539C151.881 294.707 152.208 293.916 152.678 293.21C153.148 292.505 153.753 291.899 154.457 291.428C155.161 290.957 155.951 290.629 156.781 290.463L156.782 290.463L166.706 288.484L168.006 295.024Z'
              fill='#2F2E41'
            />
            <path
              d='M213.889 293.276L208.751 293.276L202.953 273.425L210.537 273.425L213.889 293.276Z'
              fill='#FFB8B8'
            />
            <path
              d='M215.199 298.265L198.631 298.264V298.055C198.631 297.206 198.798 296.366 199.122 295.583C199.446 294.799 199.921 294.087 200.52 293.487C201.119 292.887 201.83 292.412 202.612 292.087C203.395 291.763 204.233 291.595 205.08 291.596H205.08L215.199 291.596L215.199 298.265Z'
              fill='#2F2E41'
            />
            <path
              d='M201.623 236.579C202.034 236.063 202.326 235.464 202.48 234.823C202.634 234.182 202.646 233.515 202.514 232.869C202.383 232.223 202.112 231.613 201.72 231.083C201.328 230.554 200.825 230.116 200.247 229.802L189.982 190.036L181.053 194.061L193.951 231.885C193.489 232.894 193.412 234.037 193.735 235.099C194.059 236.161 194.76 237.067 195.706 237.645C196.651 238.224 197.776 238.435 198.867 238.238C199.958 238.042 200.938 237.451 201.623 236.579Z'
              fill='#FFB8B8'
            />
            <path
              d='M192.383 196.699L182.46 199.046C182.177 199.113 181.884 199.118 181.6 199.061C181.315 199.004 181.046 198.886 180.811 198.716C180.576 198.545 180.381 198.326 180.238 198.073C180.095 197.82 180.009 197.539 179.984 197.25L179.123 187.105C178.79 185.656 179.044 184.134 179.83 182.873C180.616 181.612 181.868 180.714 183.314 180.376C184.76 180.039 186.28 180.289 187.541 181.073C188.803 181.856 189.702 183.109 190.043 184.556L193.795 193.983C193.902 194.253 193.95 194.543 193.935 194.833C193.921 195.124 193.844 195.407 193.71 195.665C193.576 195.923 193.388 196.148 193.159 196.327C192.93 196.505 192.665 196.632 192.383 196.699V196.699Z'
              fill='#6E4BE7'
            />
            <path
              d='M158.531 286.788C158.098 286.788 157.678 286.639 157.342 286.365C157.007 286.09 156.776 285.708 156.69 285.283L151.69 261.247C151.379 259.733 151.37 258.173 151.664 256.655C151.957 255.138 152.547 253.693 153.4 252.405L169.15 228.741V211.006L187.435 206.879L187.514 206.943C197 214.701 196.454 224.265 196.396 225.004L214.366 283.451C214.453 283.733 214.472 284.032 214.423 284.324C214.373 284.615 214.256 284.891 214.081 285.129C213.905 285.367 213.677 285.56 213.413 285.693C213.15 285.827 212.859 285.896 212.564 285.896H207.168C206.79 285.897 206.422 285.785 206.109 285.573C205.797 285.361 205.555 285.06 205.416 284.709L186.049 238.375L163.254 257.164C163.072 257.315 162.928 257.508 162.836 257.726C162.744 257.944 162.706 258.182 162.725 258.418L164.826 284.254C164.869 284.744 164.717 285.232 164.405 285.611C164.092 285.991 163.643 286.233 163.155 286.285L158.744 286.776C158.673 286.784 158.602 286.788 158.531 286.788Z'
              fill='#2F2E41'
            />
            <path
              d='M181.905 173.775C187.591 173.775 192.199 169.159 192.199 163.464C192.199 157.77 187.591 153.154 181.905 153.154C176.22 153.154 171.612 157.77 171.612 163.464C171.612 169.159 176.22 173.775 181.905 173.775Z'
              fill='#FFB8B8'
            />
            <path
              d='M170.125 212.973C169.75 212.973 169.383 212.862 169.071 212.653C168.759 212.444 168.517 212.148 168.373 211.801C164.925 203.321 164.982 192.61 166.494 186.247C167.139 183.553 168.707 181.171 170.925 179.516C173.143 177.861 175.87 177.039 178.632 177.192H178.632C180.276 177.279 181.883 177.71 183.351 178.455C184.819 179.2 186.115 180.244 187.157 181.52C188.199 182.796 188.964 184.276 189.403 185.865C189.841 187.454 189.944 189.117 189.704 190.747C188.898 196.219 188.571 203.926 188.468 206.985C188.452 207.393 188.305 207.786 188.049 208.103C187.792 208.421 187.44 208.648 187.045 208.748L170.585 212.916C170.434 212.954 170.28 212.973 170.125 212.973Z'
              fill='#6E4BE7'
            />
            <path
              d='M170.314 151.421C170.099 151.509 169.878 151.581 169.653 151.634L162.404 171.146L165.615 175.049L160.368 180.673L154.012 174.318C153.499 173.804 153.166 173.138 153.062 172.419C152.959 171.699 153.092 170.966 153.44 170.328L164.796 149.553C164.351 148.777 164.153 147.884 164.227 146.992C164.301 146.1 164.644 145.252 165.211 144.561C165.778 143.869 166.542 143.367 167.401 143.121C168.26 142.875 169.173 142.896 170.02 143.183C170.866 143.469 171.605 144.007 172.139 144.725C172.673 145.442 172.976 146.306 173.008 147.2C173.04 148.094 172.799 148.977 172.318 149.731C171.836 150.485 171.137 151.074 170.314 151.421Z'
              fill='#FFB8B8'
            />
            <path
              d='M158.514 180.115L164.296 171.703C164.461 171.464 164.675 171.263 164.924 171.114C165.173 170.965 165.451 170.871 165.74 170.839C166.028 170.808 166.32 170.839 166.595 170.93C166.87 171.022 167.123 171.172 167.335 171.37L174.773 178.31C175.991 179.16 176.823 180.459 177.086 181.922C177.349 183.386 177.022 184.894 176.177 186.116C175.332 187.338 174.037 188.175 172.577 188.442C171.116 188.71 169.61 188.386 168.387 187.542L159.288 183.077C159.028 182.949 158.798 182.766 158.614 182.541C158.431 182.316 158.298 182.054 158.224 181.773C158.151 181.492 158.139 181.199 158.189 180.912C158.239 180.626 158.35 180.354 158.514 180.115H158.514Z'
              fill='#6E4BE7'
            />
            <path
              d='M181.313 175.281C180.571 174.457 181.005 173.042 181.691 172.163C182.377 171.284 183.304 170.537 183.575 169.422C184.035 167.523 182.316 165.792 180.601 165.179C178.886 164.565 176.964 164.518 175.454 163.442C173.165 161.811 172.643 158.094 173.958 155.484C175.274 152.873 178.023 151.376 180.752 151.153C183.481 150.929 186.193 151.818 188.691 153.034C191.107 154.21 193.437 155.743 195.135 157.951C196.832 160.16 197.831 163.128 197.341 165.957C196.741 169.412 194.039 172.079 191.036 173.381C188.033 174.683 184.733 174.855 181.503 175.01L181.313 175.281Z'
              fill='#2F2E41'
            />
            <path
              d='M192.773 155.596C195.93 152.466 200.154 150.65 204.594 150.517C209.035 150.383 213.36 151.941 216.699 154.876C222.27 159.773 224.395 167.839 230.243 172.402C235.508 176.509 243.414 176.815 248.979 173.127C246.438 176.101 243.852 179.114 240.599 181.282C237.345 183.451 233.279 184.703 229.483 183.773C225.026 182.681 221.784 178.881 219.266 175.04C216.747 171.198 214.528 166.991 210.877 164.208C208.109 162.113 204.727 160.994 201.258 161.027C199.134 161.053 196.967 161.509 194.914 160.961C192.862 160.413 190.976 158.316 191.66 156.302L192.773 155.596Z'
              fill='#2F2E41'
            />
            <path
              d='M287.932 298.891H0.419116C0.307959 298.891 0.201355 298.847 0.122756 298.769C0.0441564 298.69 0 298.583 0 298.472C0 298.36 0.0441564 298.254 0.122756 298.175C0.201355 298.096 0.307959 298.052 0.419116 298.052H287.932C288.044 298.052 288.15 298.096 288.229 298.175C288.307 298.254 288.352 298.36 288.352 298.472C288.352 298.583 288.307 298.69 288.229 298.769C288.15 298.847 288.044 298.891 287.932 298.891Z'
              fill='#3F3D56'
            />
          </g>
          <defs>
            <clipPath id='clip0'>
              <rect width='341' height='299' fill='white' />
            </clipPath>
          </defs>
        </svg>
      </section>
      <section className='shapes mobile-none'>
        <div className='triangle'></div>
        <div className='sphere'></div>
      </section>
    </main>
  );
};

export default Main;
